function [KE, PE]=energy(t,z,m,xG,yG,zG,I1,g)   

q1 = z(1);   u1 = z(2);
q2 = z(3);   u2 = z(4);
q3 = z(5);   u3 = z(6);
q4 = z(7);   u4 = z(8);
q5 = z(9);   u5 = z(10);
q6 = z(11);   u6 = z(12);
I1_1 = I1(1,1);I1_2 = I1(2,2);I1_3 = I1(3,3); 
I1_12 = I1(1,2);I1_13 = I1(1,3);I1_23 = I1(2,3);

KE = (m*(((u5*cos(q6) + u4*cos(q5)*sin(q6))*(zG*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - yG*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + xG*cos(q5)*cos(q6)) - u3 + (u5*sin(q6) - u4*cos(q5)*cos(q6))*(yG*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - zG*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + xG*cos(q5)*sin(q6)))^2 + (u2 + (u5*sin(q6) - u4*cos(q5)*cos(q6))*(zG*cos(q4)*cos(q5) - xG*sin(q5) + yG*cos(q5)*sin(q4)) + (u6 - u4*sin(q5))*(zG*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - yG*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + xG*cos(q5)*cos(q6)))^2 + (u1 + (u5*cos(q6) + u4*cos(q5)*sin(q6))*(zG*cos(q4)*cos(q5) - xG*sin(q5) + yG*cos(q5)*sin(q4)) - (u6 - u4*sin(q5))*(yG*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - zG*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + xG*cos(q5)*sin(q6)))^2))/2 - (u5*sin(q6) - u4*cos(q5)*cos(q6))*((u6/2 - (u4*sin(q5))/2)*((sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5))*(I1_3*cos(q4)*cos(q5) - I1_13*sin(q5) + I1_23*cos(q5)*sin(q4)) - (cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5))*(I1_23*cos(q4)*cos(q5) - I1_12*sin(q5) + I1_2*cos(q5)*sin(q4)) + cos(q5)*cos(q6)*(I1_13*cos(q4)*cos(q5) - I1_1*sin(q5) + I1_12*cos(q5)*sin(q4))) - ((u5*sin(q6))/2 - (u4*cos(q5)*cos(q6))/2)*((sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5))*(I1_3*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_23*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_13*cos(q5)*cos(q6)) - (cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5))*(I1_23*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_2*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_12*cos(q5)*cos(q6)) + cos(q5)*cos(q6)*(I1_13*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_12*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_1*cos(q5)*cos(q6))) + ((u5*cos(q6))/2 + (u4*cos(q5)*sin(q6))/2)*((sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5))*(I1_23*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_3*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_13*cos(q5)*sin(q6)) - (cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5))*(I1_2*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_23*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_12*cos(q5)*sin(q6)) + cos(q5)*cos(q6)*(I1_12*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_13*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_1*cos(q5)*sin(q6)))) + (u6 - u4*sin(q5))*(((u5*cos(q6))/2 + (u4*cos(q5)*sin(q6))/2)*(cos(q4)*cos(q5)*(I1_23*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_3*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_13*cos(q5)*sin(q6)) - sin(q5)*(I1_12*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_13*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_1*cos(q5)*sin(q6)) + cos(q5)*sin(q4)*(I1_2*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_23*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_12*cos(q5)*sin(q6))) - ((u5*sin(q6))/2 - (u4*cos(q5)*cos(q6))/2)*(cos(q5)*sin(q4)*(I1_23*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_2*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_12*cos(q5)*cos(q6)) - sin(q5)*(I1_13*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_12*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_1*cos(q5)*cos(q6)) + cos(q4)*cos(q5)*(I1_3*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_23*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_13*cos(q5)*cos(q6))) + (u6/2 - (u4*sin(q5))/2)*(cos(q4)*cos(q5)*(I1_3*cos(q4)*cos(q5) - I1_13*sin(q5) + I1_23*cos(q5)*sin(q4)) - sin(q5)*(I1_13*cos(q4)*cos(q5) - I1_1*sin(q5) + I1_12*cos(q5)*sin(q4)) + cos(q5)*sin(q4)*(I1_23*cos(q4)*cos(q5) - I1_12*sin(q5) + I1_2*cos(q5)*sin(q4)))) + (u5*cos(q6) + u4*cos(q5)*sin(q6))*(((u5*cos(q6))/2 + (u4*cos(q5)*sin(q6))/2)*((cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6))*(I1_2*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_23*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_12*cos(q5)*sin(q6)) - (cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6))*(I1_23*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_3*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_13*cos(q5)*sin(q6)) + cos(q5)*sin(q6)*(I1_12*(cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6)) - I1_13*(cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6)) + I1_1*cos(q5)*sin(q6))) + (u6/2 - (u4*sin(q5))/2)*((cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6))*(I1_23*cos(q4)*cos(q5) - I1_12*sin(q5) + I1_2*cos(q5)*sin(q4)) - (cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6))*(I1_3*cos(q4)*cos(q5) - I1_13*sin(q5) + I1_23*cos(q5)*sin(q4)) + cos(q5)*sin(q6)*(I1_13*cos(q4)*cos(q5) - I1_1*sin(q5) + I1_12*cos(q5)*sin(q4))) - ((u5*sin(q6))/2 - (u4*cos(q5)*cos(q6))/2)*((cos(q4)*cos(q6) + sin(q4)*sin(q5)*sin(q6))*(I1_23*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_2*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_12*cos(q5)*cos(q6)) - (cos(q6)*sin(q4) - cos(q4)*sin(q5)*sin(q6))*(I1_3*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_23*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_13*cos(q5)*cos(q6)) + cos(q5)*sin(q6)*(I1_13*(sin(q4)*sin(q6) + cos(q4)*cos(q6)*sin(q5)) - I1_12*(cos(q4)*sin(q6) - cos(q6)*sin(q4)*sin(q5)) + I1_1*cos(q5)*cos(q6))));
PE = g*m*(q3 - xG*sin(q5) + zG*cos(q4)*cos(q5) + yG*cos(q5)*sin(q4));
