clear functions % This line is really needed!close allclear all%%%%%%%%% INITIALIZE PARAMETERS %%%%%%%Mechanical parameters.m1  =  1;    m2 =  1;  % massesI1  =  5*eye(3);  I2 = 5*eye(3);  % inertias about cmsl   =  1;              % length of linksa   =  .5;            % dist. from O to G1 and E to G2 (see figures)g   =  10;% Initial conditions and other settings.framespersec=50;  %if view is not speeded or slowed in dbpend_animateT=5;             %duration of animation  in secondstspan=linspace(0,T,T*framespersec);q1    = pi/3; %u1    = 0;        %  q2    = pi/2 ;      %u2    = 0;        %z0=[q1 u1 q2 u2]';options=odeset('abstol',1e-9,'reltol',1e-9);%%%%%%% INTEGRATOR or ODE SOLVER %%%%%%%[t z] = ode113('rhs',tspan,z0,options, ...                          m1, m2, I1, I2, l, a, g);%%%%%%% POSTPROCESSING %%%%%%%%%%%%%%%%% A routine to animate the results% To speed up change the framespersecondfigure(1)for i=1:length(tspan)%      pause(.1)    q1=z(i,1);    q2=z(i,3);    xm1=l*cos(q1);%-l*sin(z(i,1));%modified by cxc in Jan. 2018    ym1=l*sin(q1);    zm1=0;    xm2=l*cos(q1) + l*sin(q1)*sin(q2);%xm1-l*sin(z(i,3));%modified by cxc in Jan. 2018    ym2=l*sin(q1) - l*cos(q1)*sin(q2);    zm2=l*cos(q2);       plot3([0],[0],[0],'ko','MarkerSize',3); %pivot point    hold on    plot3([0 xm1],[0 ym1],[0 zm1],'r','LineWidth',2);% first pendulum    hold on    plot3([xm1 xm2],[ym1 ym2],[zm1 zm2],'b','LineWidth',2);% second pendulum     axis([-2*l 2*l -2*l 2*l -2*l 2*l]);    axis square    hold onendxlabel('x'); ylabel('y'); zlabel('z');%Get some plotsfigure(2)plot(t,z(:,1),t,z(:,3));xlabel('time (s)'); ylabel('position (rad)');%%% energy check, Total energy should be constant%%% here we plot successive difference in total energies (should be zero)%%% NOTE: %%% a) energy difference can not be better than the ode tolerance. %%%    This is one way to check if simulations are alright. %%% b) This is not true if the system is actuated or there are dissipative%%%    forces like dampers. The TE here consists of conservative forces. for i=1:length(t)    [KE(i), PE(i)] = energy(t(i),z(i,:),m1, m2, I1, I2, l, a, g);endTE = KE + PE;TE_diff = diff(TE);figure(3)plot(t(1:end-1),TE_diff)figure(4)plot(t,KE,'r.',t,PE,'b*') 